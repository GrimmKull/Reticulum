<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>WebSocket test</title>
  </head>
  <body>

    <h1>WebSocket test</h1>
    <div id="rega">Register Alice</div>
    <div id="regb">Register Bob</div>
    <div id="inva">Invite Alice</div>
    <br>
    <div id="invb">Invite Bob</div>
    <ul>
    </ul>

    <script type="text/javascript">
      var logger = document.getElementsByTagName('ul')[0],
          Socket = window.MozWebSocket || window.WebSocket,
          protos = ['sip'],
          socket = new Socket('ws://' + location.hostname + ':' + location.port + '/', protos),
          index  = 0;

console.log(socket)
      var log = function(text) {
        logger.innerHTML += '<li>' + text + '</li>';
      };

      var sipmsg0 = [
          "INVITE sip:alice:alicespassword@atlanta.com:10050;parameters?headers SIP/2.0",
          "Via: SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8",
          "To: Alice <sip:alice@atlanta.com>",
          "From: Bob <sip:bob@biloxi.com>;tag=1928301774",
          "Call-ID: a84b4c76e66710",
          "CSeq: 314159 INVITE",
          "Max-Forwards: 70",
          "Contact: <sip:alice@pc33.atlanta.com>",
          "Content-Type: application/pkcs7-mime; smime-type=enveloped-data; name=smime.p7m",
          "Content-Disposition: attachment; filename=smime.p7m handling=required",
          "",
          "1234567890"
      ].join("\r\n");

      var sipmsg1 = [
      "REGISTER sip:registrar.atlanta.com SIP/2.0",
      "Via: SIP/2.0/UDP alicespc.atlanta.com:5060;branch=z9hG4bKnashds7",
      "Max-Forwards: 70",
      "To: Alice <sip:alice@atlanta.com>",
      "From: Alice <sip:alice@atlanta.com>;tag=456248",
      "Call-ID: 843817637684230@998sdasdh09",
      "CSeq: 1826 REGISTER",
      "Contact: <sip:alice@192.0.2.4>",
      "Expires: 7200",
      "Content-Length: 0",
      "",
      "",
      ].join("\r\n");

      var sipmsg2 = [
      "REGISTER sip:registrar.biloxi.com SIP/2.0",
      "Via: SIP/2.0/UDP bobspc.biloxi.com:5060;branch=z9hG4bKnashds7",
      "Max-Forwards: 70",
      "To: Bob <sip:bob@biloxi.com>",
      "From: Bob <sip:bob@biloxi.com>;tag=456248",
      "Call-ID: 843817637684230@998sdasdh09",
      "CSeq: 1826 REGISTER",
      "Contact: <sip:bob@192.0.2.4>",
      "Expires: 7200",
      "Content-Length: 0",
      "",
      "",
      ].join("\r\n");

      var sipmsg3 = [
      "SIP/2.0 200 OK",
      "Via: SIP/2.0/UDP bobspc.biloxi.com:5060;branch=z9hG4bKnashds7 ;received=192.0.2.4",
      "To: Bob <sip:bob@biloxi.com>;tag=2493k59kd",
      "From: Bob <sip:bob@biloxi.com>;tag=456248",
      "Call-ID: 843817637684230@998sdasdh09",
      "CSeq: 1826 REGISTER",
      "Contact: <sip:bob@192.0.2.4>",
      "Expires: 7200",
      "Content-Length: 0",
      "",
      "",
      ].join("\r\n");

      var sipmsg4 = [
      "SIP/2.0 200 OK",
      "Via: SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKhjhs8ass877 ;received=192.0.2.4",
      "To: <sip:carol@chicago.com>;tag=93810874",
      "From: Alice <sip:alice@atlanta.com>;tag=1928301774",
      "Call-ID: a84b4c76e66710",
      "CSeq: 63104 OPTIONS",
      "Contact: <sip:carol@chicago.com>",
      "Contact: <mailto:carol@chicago.com>",
      "Allow: INVITE, ACK, CANCEL, OPTIONS, BYE",
      "Accept: application/sdp",
      "Accept-Encoding: gzip",
      "Accept-Language: en",
      "Supported: foo",
      "Content-Type: application/sdp",
      "Content-Length: 274",
      "",
      "",
      ].join("\r\n");

      var sipmsg5 = [
      "INVITE sip:bob@u2.biloxi.com SIP/2.0",
      "Record-Route: <sip:p2.biloxi.com;lr>",
      "Record-Route: <sip:p1.atlanta.com;lr>",
      "From: Alice <sip:alice@atlanta.com>;tag=1354385",
      "To: Bob <sip:bob@biloxi.com>",
      "Call-ID: xyz",
      "CSeq: 1 INVITE",
      "Contact: <sip:alice@u1.atlanta.com>",
      "",
      "",
      ].join("\r\n");

      var sipmsg6 = [
      "SIP/2.0 180 Ringing",
      "Record-Route: <sip:p2.biloxi.com;lr>",
      "Record-Route: <sip:p1.atlanta.com;lr>",
      "From: Alice <sip:alice@atlanta.com>;tag=1354385",
      "To: Bob <sip:bob@biloxi.com>",
      "Call-ID: xyz",
      "CSeq: 1 INVITE",
      "Contact: <sip:bob@u2.biloxy.com>",
      "",
      "",
      ].join("\r\n");

    var sipmsg7 = [
    "INVITE sip:bob@biloxi.example.com SIP/2.0",
    "Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1",
    "Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9;received=192.0.2.101",
    "Max-Forwards: 69",
    "Record-Route: <sip:ss1.atlanta.example.com;lr>",
    "From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl",
    "To: Bob <sip:bob@biloxi.example.com>",
    "Call-ID: 3848276298220188511@atlanta.example.com",
    "CSeq: 2 INVITE",
    "Contact: <sip:alice@client.atlanta.example.com;transport=tcp>",
    "Content-Type: application/sdp",
    "Content-Length: 151",
    "",
    "v=0",
    "o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com",
    "s=-",
    "c=IN IP4 192.0.2.101",
    "t=0 0",
    "m=audio 49172 RTP/AVP 0",
    "a=rtpmap:0 PCMU/8000",
    ].join("\r\n");

      socket.addEventListener('open', function() {
        log('OPEN: ' + socket.protocol);
        //socket.send(sipmsg2);
      });

      socket.onerror = function(event) {
        log('ERROR: ' + event.message);
      };

      socket.onmessage = function(event) {
        data = event.data
        data = data.replace(/\</g, "&lt;");
        data = data.replace(/\>/g, "&gt;");
        log('MESSAGE: ' + data);
        //setTimeout(function() { socket.send(++index + ' ' + event.data) }, 2000);
      };

      socket.onclose = function(event) {
        log('CLOSE: ' + event.code + ', ' + event.reason);
      };

      document.getElementById("rega").onclick = function() {socket.send(sipmsg1); console.log(1)}
      document.getElementById("regb").onclick = function() {socket.send(sipmsg2); console.log(2)}
      document.getElementById("inva").onclick = function() {socket.send(sipmsg0); console.log(0)}
      document.getElementById("invb").onclick = function() {socket.send(sipmsg7); console.log(7)}
    </script>

  </body>
</html>
